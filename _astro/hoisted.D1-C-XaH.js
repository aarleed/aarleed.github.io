import"https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js";const c=["test","tree","exam","dog","cat","book","bark","sun","shine","pages","desk","cabinet"];let g=Array(c.length).fill(!1),s=new Set;const m=new Map;m.set("tree","bark");m.set("dog","cat");m.set("test","exam");m.set("sun","shine");m.set("book","pages");m.set("desk","cabinet");const b=3;let y=[],i=0,h={"<6":0,"6-8":0,"9-11":0,"12+":0},S=[];function N(){let e=localStorage.getItem("currentDate");const t=new Date;e!=null?(e=new Date(e),w(e,t)?console.log("new date new game"):localStorage.key("explored")!=null?(console.log("using previous state"),E(!0),localStorage.setItem("currentDate",t.toISOString())):k(t)):k(t)}function k(e){console.log("using initial state"),E(!1),localStorage.setItem("statistics",i.toString());let t=Array.from(s);localStorage.setItem("explored",JSON.stringify(g)),localStorage.setItem("finished",JSON.stringify(t)),localStorage.setItem("currentDate",e.toISOString())}function w(e,t){const n=e.getFullYear(),a=e.getMonth(),o=e.getDate(),r=t.getFullYear(),l=t.getMonth(),d=t.getDate();return r===n&&l===a&&d===o+1}function E(e){if(e){g=JSON.parse(localStorage.getItem("explored"));const n=JSON.parse(localStorage.getItem("finished"));s=new Set(n),i=JSON.parse(localStorage.getItem("statistics"))}let t=document.getElementById("game-board");for(let n=0;n<b;n++){let a=document.createElement("div");a.className="letter-row";for(let o=0;o<4;o++){let r=document.createElement("div");r.className="card";let l=document.createElement("div");l.className="card-inner",r.appendChild(l);let d=document.createElement("div");d.className="card-front",d.textContent=c[n*4+o];let u=document.createElement("div");u.className="card-back",u.textContent=c[n*4+o],l.appendChild(d),l.appendChild(u),e&&s.has(n*4+o)&&(u.style.backgroundColor="#6ca965",p(l)),a.appendChild(r)}t.appendChild(a)}}function C(e=null){var t=document.getElementById("modal"),n=document.getElementById("close");t.style.display="block",n.onclick=function(){modal.style.display="none"},window.onclick=function(a){a.target==modal&&(modal.style.display="none")},localStorage.setItem("noIntro","true")}N();localStorage.getItem("noIntro")||C();var I=document.querySelectorAll(".card");console.log(I);const D=(e,t)=>{var n=e.querySelector(".card-inner");p(n),A(e,t)};I.forEach(function(e,t){if(!s.has(t)){var n=function(){D(e,t)};y.push(n),e.addEventListener("click",n)}});function O(e){let t=e[0][0],n=e[0][1],a=e[1][0],o=e[1][1];m.get(c[n])===c[o]||m.get(c[o])===c[n]?(console.log("correct"),v(t,a,n,o,!0)):(g[n]&&g[o]&&(i+=1,localStorage.setItem("statistics",i.toString())),v(t,a,n,o,!1))}function A(e,t){S.push([e,t]),S.length==2&&(O(S),S=[]),g[t]||s.has(t)?(console.log("already explored"),console.log(g[t]),console.log(s.has(t))):g[t]=!0,localStorage.setItem("explored",JSON.stringify(g))}function p(e){e.classList.toggle("flipCard")}function v(e,t,n,a,o){if(o){console.log("update with green, animation, removeEventListener"),e.removeEventListener("click",y[n]),t.removeEventListener("click",y[a]),setTimeout(function(){var l=e.querySelector(".card-back"),d=t.querySelector(".card-back");l.style.backgroundColor="#6ca965 ",d.style.backgroundColor="#6ca965",f(e,"flipInX"),f(t,"flipInX")},1e3),s.add(n),s.add(a);let r=Array.from(s);localStorage.setItem("finished",JSON.stringify(r)),c.length==s.size&&L()}else setTimeout(function(){f(e,"headShake"),f(t,"headShake")},300),setTimeout(function(){var r=e.querySelector(".card-inner"),l=t.querySelector(".card-inner");p(r),p(l)},1700),console.log("animate, update with cards flipped back");B(n,a,o)}function L(){setTimeout(function(){I.forEach(function(t){f(t,"flipInX")});let e=document.getElementById("game-dialog");e.textContent="Nice! You finished with "+i.toString()+" mistakes"},1500),h=x(h),localStorage.setItem("history",JSON.stringify(h))}function x(e){let t=localStorage.getItem(key);switch(t!=null&&(e=JSON.parse(t)),console.log(e),!0){case i<6:e["<6"]+=1;break;case(i>=6&&i<=8):e["6-8"]+=1;break;case(i>=9&&i<=12):e["9=11"]+=1;break;default:console.log("Mistakes is greater than 12")}return e}function B(e,t,n){let a=document.getElementById("game-dialog");n?a.textContent=c[e]+" and "+c[t]+" are a pair! Nice job!":a.textContent=c[e]+" and "+c[t]+" are not a pair.. try again!"}const f=(e,t,n="animate__")=>new Promise((a,o)=>{const r=`${n}${t}`,l=e;l.style.setProperty("--animate-duration","0.3s"),l.classList.add(`${n}animated`,r);function d(u){u.stopPropagation(),l.classList.remove(`${n}animated`,r),a("Animation ended")}l.addEventListener("animationend",d,{once:!0})});
